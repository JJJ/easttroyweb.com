/*! 1.0.6 */
!function(a,b,c){"use strict";function d(){var a={},d={},e={},f={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},g=function(){return basisHTMLBuilderData.iterator},h=function(){return basisHTMLBuilderData.iterator++,g()},i=function(a,c,d){d=d||"";var e={},f={},g="basiseditortemp"+c+d;e[a]=tinyMCEPreInit.mceInit[g],f[a]=tinyMCEPreInit.qtInit[g],tinyMCEPreInit.mceInit=b.extend(tinyMCEPreInit.mceInit,e),tinyMCEPreInit.qtInit=b.extend(tinyMCEPreInit.qtInit,f),tinyMCEPreInit.mceInit[a].elements=a,tinyMCEPreInit.qtInit[a].id=a,"tinymce"===basisMCE&&tinyMCE.init(tinyMCEPreInit.mceInit[a]),QTags.instances[0]=!1,quicktags(tinyMCEPreInit.qtInit[a]);var h=b("#wp-"+a+"-wrap");h.on("click",".add_media",{id:a},function(a){wpActiveEditor=a.data.id}),h.on("click",{id:a},function(a){wpActiveEditor=a.data.id})},j=function(a,c){a=a.join(),b("#basis-section-order-"+c).val(a)},k=function(a,c){var d,e=b("#basis-section-order-"+c).val();""===e?d=[a]:(d=e.split(","),d.push(a)),j(d,c)},l=function(a,d){var e,f=b("#basis-section-order-"+d).val();""===f?e=[]:(e=f.split(","),e=c.reject(e,function(b){return a===b})),j(e,d)},m=400,n=250;return{Collections:a,Models:d,Views:e,templateOptions:f,getIterator:g,incrementIterator:h,initEditor:i,setSectionOrder:j,addSectionsOrder:k,removeSectionsOrder:l,openSpeed:m,closeSpeed:n}}a.BasisBuilderApp=new d}(window,jQuery,_),function(a,b,c,d,e){"use strict";e.Models.Section=b.Model.extend({defaults:{sectionType:"",viewName:"",iterator:0,builder:""},initialize:function(){var a=this.get("sectionType").charAt(0).toUpperCase()+this.get("sectionType").slice(1);this.set("viewName",a)}}),e.Models.Section.prototype.sync=function(){return null},e.Models.Section.prototype.fetch=function(){return null},e.Models.Section.prototype.save=function(){return null}}(window,Backbone,jQuery,_,BasisBuilderApp),function(a,b,c,d,e){"use strict";e.Collections.Sections=b.Collection.extend({model:e.Models.Section,initialize:function(a){this.builder=a.builder,this.$stage=c("#basis-stage-"+this.builder)},toggleStageClass:function(){var a=c(".basis-section",this.$stage).length;a>0?this.$stage.removeClass("basis-stage-closed"):this.$stage.addClass("basis-stage-closed")}}),e.sectionsProduct=new e.Collections.Sections({builder:"product"}),e.sectionsSlideshow=new e.Collections.Sections({builder:"slideshow"})}(window,Backbone,jQuery,_,BasisBuilderApp),function(a,b,c,d,e){"use strict";e.Views.MenuProduct=b.View.extend({el:"#basis-menu-product",$stage:c("#basis-stage-product"),$document:c(a.document),$scrollHandle:c("html, body"),$pane:c(".basis-menu-product-pane"),initialize:function(){this.listenTo?this.listenTo(e.sectionsProduct,"add",this.addOne):e.sectionsProduct.on("add",this.addOne,this)},events:{"click .basis-menu-product-list-item-link":"addSection","click .basis-menu-product-tab-link":"menuToggle"},addSection:function(a){a.preventDefault();var b=c(a),d=c(b.get(0).currentTarget),f=d.attr("data-section").replace(/\W/g,"");e.sectionsProduct.create({sectionType:f,iterator:e.incrementIterator(),builder:"product"})},addOne:function(a){var b=a.get("sectionType"),f=a.get("iterator"),g=new e.Views.Section({model:a,collection:"product"}),h=g.render().el;if(this.$stage.append(h),this.$scrollHandle.animate({scrollTop:parseInt(c("#"+g.id).offset().top,10)-32-9},800,"easeOutQuad"),e.addSectionsOrder("basis-section-"+f,"product"),"profile"!==b){var i="basiseditor"+b+e.getIterator();e.initEditor(i,b,"")}else d.each(["left","middle","right"],function(a){i="basiseditor"+b+e.getIterator()+a,e.initEditor(i,b,a)});e.sectionsProduct.toggleStageClass()},menuToggle:function(a){a.preventDefault();var b=basisHTMLBuilderData.pageID,c="basismt"+parseInt(b,10);this.$pane.is(":hidden")?this.$pane.slideDown({duration:e.openSpeed,easing:"easeInOutQuad",complete:function(){deleteUserSetting(c),this.$el.addClass("basis-menu-product-opened").removeClass("basis-menu-product-closed")}.bind(this)}):this.$pane.slideUp({duration:e.closeSpeed,easing:"easeInOutQuad",complete:function(){setUserSetting(c,"c"),this.$el.addClass("basis-menu-product-closed").removeClass("basis-menu-product-opened")}.bind(this)})},validateViewName:function(a){return a in e.Views}})}(window,Backbone,jQuery,_,BasisBuilderApp),function(a,b,c,d,e){"use strict";e.Views.MenuSlideshow=b.View.extend({el:"#basis-menu-slideshow",$stage:c("#basis-stage-slideshow"),$document:c(a.document),$scrollHandle:c("html, body"),initialize:function(){this.listenTo?this.listenTo(e.sectionsSlideshow,"add",this.addOne):e.sectionsSlideshow.on("add",this.addOne,this)},events:{"click .basis-menu-slideshow-add":"addSection"},addSection:function(a){a.preventDefault(),e.sectionsSlideshow.create({sectionType:"slide",iterator:e.incrementIterator(),builder:"slideshow"})},addOne:function(a){var b=a.get("sectionType"),d=a.get("iterator"),f=new e.Views.Section({model:a}),g=f.render().el;this.$stage.append(g),this.$scrollHandle.animate({scrollTop:parseInt(c("#"+f.id).offset().top,10)-32-9},800,"easeOutQuad"),e.addSectionsOrder("basis-section-"+d,"slideshow");var h="basiseditor"+b+e.getIterator();e.initEditor(h,b,""),e.sectionsSlideshow.toggleStageClass()}})}(window,Backbone,jQuery,_,BasisBuilderApp),function(a,b,c,d,e){"use strict";e.Views.Section=b.View.extend({template:"",className:"basis-section basis-section-open",$headerTitle:"",$titleInput:"",$titlePipe:"",serverRendered:!1,collectionHolder:"",$document:c(a.document),events:{"click .basis-section-toggle":"toggleSection","click .basis-section-remove":"removeSection","keyup .basis-section-header-title-input":"constructHeader","click .basis-media-uploader-add":"initUploader","click .basis-media-uploader-remove":"removeImage","click .wp-switch-editor":"adjustEditorHeightOnClick"},initialize:function(a){this.model=a.model,this.id="basis-section-"+this.model.get("iterator"),this.serverRendered=a.serverRendered?a.serverRendered:!1,this.collectionHolder="product"===this.model.get("builder")?"sectionsProduct":"sectionsSlideshow",d.templateSettings=e.templateOptions,this.template=d.template(c("#tmpl-basis-"+this.model.get("sectionType")).html()),!0===this.serverRendered&&d.contains(["feature","profile"],this.model.get("sectionType"))&&this.initSortableColumns()},render:function(){return this.$el.html(this.template(this.model.toJSON())).addClass("basis-section-"+this.model.get("sectionType")).attr("id",this.id),d.contains(["feature","profile"],this.model.get("sectionType"))&&this.initSortableColumns(),this},toggleSection:function(a){a.preventDefault();var b=c(a.target),d=b.parents(".basis-section"),f=c(".basis-section-body",d),g=c(".basis-section-state",this.$el);d.hasClass("basis-section-open")?f.slideUp(e.closeSpeed,function(){d.removeClass("basis-section-open"),g.val("closed")}):f.slideDown(e.openSpeed,function(){d.addClass("basis-section-open"),g.val("open")})},removeSection:function(a){a.preventDefault(),e.removeSectionsOrder("basis-section-"+this.model.get("iterator"),this.model.get("builder")),this.$el.animate({opacity:"toggle",height:"toggle"},e.closeSpeed,function(){this.remove(),e[this.collectionHolder].toggleStageClass()}.bind(this))},constructHeader:function(){""===this.$headerTitle&&(this.$headerTitle=c(".basis-section-header-title",this.$el)),""===this.$titleInput&&(this.$titleInput=c(".basis-section-header-title-input",this.$el)),""===this.$titlePipe&&(this.$titlePipe=c(".basis-section-header-pipe",this.$el));var a=this.$titleInput.val();this.$headerTitle.html(d.escape(a)),""===a?this.$titlePipe.addClass("basis-section-header-pipe-hidden"):this.$titlePipe.removeClass("basis-section-header-pipe-hidden")},initUploader:function(a){a.preventDefault();var b=c(a.target),d=b.parents(".basis-uploader"),e=c(".basis-media-uploader-placeholder",d),f=c(".basis-media-uploader-value",d),g=c(".basis-media-uploader-remove",d),h=c(".basis-media-uploader-set-link",d),i=i||{};return"function"==typeof i.open?(i.open(),void 0):(i=wp.media.frames.frame=wp.media({title:b.data("title"),button:{text:b.data("buttonText")},multiple:!1}),i.on("select",function(){var a=i.state().get("selection").first().toJSON();a.caption="";var b=wp.media.string.props({},a);b.url=a.url;var c=wp.media.string.image(b);e.html(c),f.val(a.id),h.hide(),g.show()}),i.open(),void 0)},removeImage:function(a){a.preventDefault();var b=c(a.target),d=b.parents(".basis-uploader"),e=c(".basis-media-uploader-placeholder",d),f=c(".basis-media-uploader-value",d),g=c(".basis-media-uploader-add",d);e.empty(),f.removeAttr("value"),b.hide(),g.show()},initSortableColumns:function(){var a=this;c(".basis-section-sortable-stage",this.$el).sortable({handle:".basis-sortable-handle",placeholder:"sortable-placeholder",forcePlaceholderSizeType:!0,distance:2,tolerance:"pointer",start:function(b,d){var e=c(".basis-sortable",a.$el),f=c(d.item.get(0)),g=c(d.item.get(0)).height();c.each(e,function(){var a=c(this).height();g=a>g?a:g}),c(".sortable-placeholder",a.$el).height(g);var h=c(".wp-editor-area",f).attr("id");void 0!==h&&(tinyMCE.execCommand("mceRemoveControl",!1,h),delete tinyMCE.editors.id)},stop:function(b,d){var e=c(d.item.get(0)),f=c(this).sortable("toArray");c(".basis-section-order",a.$el).val(f);var g=c(".wp-editor-area",e).attr("id"),h=c(".wp-editor-wrap",e),i=tinyMCE.DOM.get(g);void 0!==g&&h.hasClass("tmce-active")&&(i.value=switchEditors.wpautop(i.value),tinyMCE.execCommand("mceAddControl",!1,g))}})},syncEditorHeight:function(a,b){b=b||"iframe";var d=c(a.target),e=d.parents(".wp-editor-wrap"),f=c(".mceIframeContainer iframe",e),g=f.height(),h=c("textarea",e),i=h.height();"iframe"===b?h.height(parseInt(g,10)+1):f.height(parseInt(i,10)-1)},adjustEditorHeightOnClick:function(a){a.preventDefault();var b=c(a.target),d=b.hasClass("switch-html")?"iframe":"textarea";this.syncEditorHeight(a,d)}})}(window,Backbone,jQuery,_,BasisBuilderApp),function(a,b,c){"use strict";var d=function(){function d(){e(),g(),f()}function e(){m.$window=b(window),m.$document=b(document),m.$sortInput=b("#basis-section-order-product"),m.$pageParentDiv=b("#pageparentdiv"),m.$pageTemplate=b("#page_template"),m.$builderProduct=b("#basis_builder_product"),m.$productHide=b("#basis_builder_product-hide"),m.$builderSlideshow=b("#basis_builder_slideshow"),m.$slideshowHide=b("#basis_builder_slideshow-hide"),m.$mainEditor=b("#postdivrich"),m.$postImageDiv=b("#postimagediv"),m.$commentStatusDiv=b("#commentstatusdiv"),m.$commentsDiv=b("#commentsdiv"),m.$revisionsInfo=b(".misc-pub-revisions")}function f(){m.$pageTemplate.on("change",j),m.$document.on("ready",k)}function g(){l(),new a.Views.MenuProduct,new a.Views.MenuSlideshow,h(),i()}function h(){b(".basis-stage").sortable({handle:".basis-section-header",placeholder:"sortable-placeholder",forcePlaceholderSizeType:!0,distance:2,tolerance:"pointer",start:function(a,c){var d=b(c.item.get(0)),e=d.parents(".basis-stage");b(".sortable-placeholder",e).height(d.height()),b(".wp-editor-area",d).each(function(){var a=b(this),c=a.attr("id");tinyMCE.execCommand("mceRemoveControl",!1,c),delete tinyMCE.editors.id})},stop:function(c,d){var e=b(d.item.get(0)),f=e.parents(".basis-stage"),g=b(this).sortable("toArray");a.setSectionOrder(g,f.attr("id").replace("basis-stage-","")),b(".wp-editor-area",e).each(function(){var a=b(this),c=a.attr("id"),d=a.parents(".wp-editor-wrap"),e=tinyMCE.DOM.get(c);d.hasClass("tmce-active")&&(e.value=switchEditors.wpautop(e.value),console.log(e.value),tinyMCE.execCommand("mceAddControl",!1,c))})}})}function i(){b(".basis-section").each(function(){var c=b(this),d=c.attr("id"),e=c.attr("data-iterator"),f=c.attr("data-section-type"),g=c.parents(".basis-stage").attr("id").replace("basis-stage-",""),h=new a.Models.Section({sectionType:f,iterator:e,builder:g});new a.Views.Section({model:h,el:b("#"+d),serverRendered:!0})})}function j(a){var c=b(a.target).val();"product.php"===c?(m.$builderProduct.show(),m.$builderSlideshow.hide(),m.$mainEditor.hide(),m.$postImageDiv.hide(),m.$commentStatusDiv.hide(),m.$commentsDiv.hide(),m.$productHide.prop("checked",!0).parent().show(),m.$slideshowHide.prop("checked",!1).parent().hide(),m.$basishideheader.show(),m.$revisionsInfo.hide()):"slideshow.php"===c?(m.$builderSlideshow.show(),m.$builderProduct.hide(),m.$mainEditor.hide(),m.$postImageDiv.hide(),m.$commentStatusDiv.hide(),m.$commentsDiv.hide(),m.$slideshowHide.prop("checked",!0).parent().show(),m.$productHide.prop("checked",!1).parent().hide(),m.$basishideheader.show(),m.$revisionsInfo.hide()):(m.$builderProduct.hide(),m.$builderSlideshow.hide(),m.$mainEditor.show(),m.$postImageDiv.show(),m.$commentStatusDiv.show(),m.$commentsDiv.show(),m.$productHide.prop("checked",!1).parent().hide(),m.$slideshowHide.prop("checked",!1).parent().hide(),m.$basishideheader.hide(),m.$revisionsInfo.show()),postboxes.save_state(pagenow)}function k(){wpLink.open=function(){if(wpActiveEditor){var a={};a.dialog=b("#wp-link");var c=wpActiveEditor.replace(/\[/g,"\\[").replace(/]/g,"\\]");wpLink.textarea=b("#"+c).get(0),a.dialog.data("wpdialog")||a.dialog.wpdialog({title:wpLinkL10n.title,width:480,height:"auto",modal:!0,dialogClass:"wp-dialog"}),a.dialog.wpdialog("open")}}}function l(){var a=c.template('<p><strong>Minimal Mode</strong></p><label id="basis-hide-header-option" for="basis-hide-header" style="display:none;"><input type="checkbox" id="basis-hide-header" name="basis-hide-header" value="1" <%= hideHeaderChecked %> /> <%- hideHeaderLabel %></label>',basisHTMLBuilderData),d=b("#menu_order",m.$pageParentDiv).parent();d.after(a),m.$basishideheader=b("#basis-hide-header-option")}var m={};d()};window.BasisAdmin=new d}(BasisBuilderApp,jQuery,_);